<!doctype html><html lang=en dir=auto data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How Elasticsearch cluster works | Duy Do</title><meta name=keywords content="elasticsearch,engineering,searchengine,informationretrieval"><meta name=description content="This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:

How a node in cluster talks to others?
What happens when a node joins or leaves the cluster?
What happens when a node stops or has encountered a problem?
"><meta name=author content="Duy Do"><link rel=canonical href=https://duydo.me/how-elasticsearch-cluster-works/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://duydo.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://duydo.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://duydo.me/favicon-32x32.png><link rel=apple-touch-icon href=https://duydo.me/apple-touch-icon.png><link rel=mask-icon href=https://duydo.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://duydo.me/how-elasticsearch-cluster-works/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"&&(document.querySelector("html").dataset.theme="dark")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MWQHCX1NZ9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MWQHCX1NZ9")</script><meta property="og:url" content="https://duydo.me/how-elasticsearch-cluster-works/"><meta property="og:site_name" content="Duy Do"><meta property="og:title" content="How Elasticsearch cluster works"><meta property="og:description" content="This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:
How a node in cluster talks to others? What happens when a node joins or leaves the cluster? What happens when a node stops or has encountered a problem? "><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-10-24T11:16:00+07:00"><meta property="article:modified_time" content="2016-10-24T11:16:00+07:00"><meta property="article:tag" content="Elasticsearch"><meta property="article:tag" content="Engineering"><meta property="article:tag" content="Searchengine"><meta property="article:tag" content="Informationretrieval"><meta property="og:image" content="https://duydo.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://duydo.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="How Elasticsearch cluster works"><meta name=twitter:description content="This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:

How a node in cluster talks to others?
What happens when a node joins or leaves the cluster?
What happens when a node stops or has encountered a problem?
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://duydo.me/posts/"},{"@type":"ListItem","position":2,"name":"How Elasticsearch cluster works","item":"https://duydo.me/how-elasticsearch-cluster-works/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How Elasticsearch cluster works","name":"How Elasticsearch cluster works","description":"This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:\nHow a node in cluster talks to others? What happens when a node joins or leaves the cluster? What happens when a node stops or has encountered a problem? ","keywords":["elasticsearch","engineering","searchengine","informationretrieval"],"articleBody":"This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:\nHow a node in cluster talks to others? What happens when a node joins or leaves the cluster? What happens when a node stops or has encountered a problem? A Cluster of Nodes When we start an instance of Elasticsearch, we are starting a node and we have a cluster with single node. We start another instance of Elasticsearch has same cluster.name with the first instance and we have a cluster with two nodes. We can start more instances of Elasticsearch to form a cluster with number of nodes we want.\nEvery node in the cluster knows about the other nodes within the cluster, they talk to others directly using the native Elasticsearch language over TCP. This is known as a full connected mesh topology:\nFigure 1. Full connected mesh topology (source https://upload.wikimedia.org/wikipedia/commons/3/3c/NetworkTopology-FullyConnected.png)\nBesides that, the nodes are able to talk to external world using JSON “language” over HTTP.\nSo, we can say:\nElasticsearch is peer-to-peer based system, nodes communicate with others directly.\nEach node in the cluster plays one or more roles; it can be a master node, data node, client node, or tribe node. Ech role has it own purpose.\nThe master node is responsible for creating, deleting indices, adding the nodes or remove the nodes from the cluster. Each time a cluster state is changed, the master node broadcasts the changes to other nodes in the cluster. There is only one master node in the cluster at a time.\nThe data node is responsible for holding the data in the shards and performing data related operations such as create, read, update, delete, search, and aggregations. We can have many data nodes in the cluster. If one of the data nodes stops, the cluster still operates and re-organizes the data on other nodes.\nThe client node is responsible for routing the cluster-related requests to the master node and the data-related requests to the data nodes, it acts as a “smart router”. The client node does not hold any data, it also cannot become the master node.\nFigure 2. The client node routes the data-related request to every data nodes in the cluster. Figure 3. The client node routes the cluster-related request to the master node in the cluster.\nThe tribe node is special type of client node that is able to talk to multiple clusters to perform search and other operations.\nThe ingest node is responsible for pre-processing documents before the actual indexing takes into account.\nNow we know role of each node, next we look at what happens behind the sence when a node joins or leaves the cluster.\nAdd a Node to the Cluster When we start a node, the node is starting to ping all the nodes in the cluster for finding the master node. Once the master is found, it will ask the master to join by sending a join request; the master accepts it as a new node of the cluster and then notify all the nodes in the cluster about presense of the new node, and finally the new node connects to all other nodes.\nIf the joined node is a data node, the master will reallocate the data evenly across the nodes.\nRemove a Node from the Cluster If we stop a node or a node in the cluster is unresponsive in specific amout of time, the master node will remove it from the cluster and reallocate the data if the removed node is a data node.\nYou might be curious about how the master node knows if other nodes in the cluster are still alive. The master has a fault detection machanism, it pings all the other nodes in the cluster and verify that they are alive or not.\nAnd about the master, what happens if it stops or has encountered a problem? Same the master node, each node in the cluster also have a fault detection machanism, it pings to master to verify if its still alive. If the master is not alive, other master-eligible nodes will be elected new master to replace the down one within seconds.\nIn the next post in this series, we will look at how Elasticsearc index data in a distributed maner.\n","wordCount":"735","inLanguage":"en","image":"https://duydo.me/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2016-10-24T11:16:00+07:00","dateModified":"2016-10-24T11:16:00+07:00","author":{"@type":"Person","name":"Duy Do"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://duydo.me/how-elasticsearch-cluster-works/"},"publisher":{"@type":"Organization","name":"Duy Do","logo":{"@type":"ImageObject","url":"https://duydo.me/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://duydo.me/ accesskey=h title="Duy Do (Alt + H)">Duy Do</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://duydo.me/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How Elasticsearch cluster works</h1><div class=post-meta><span title='2016-10-24 11:16:00 +0700 +07'>Oct 24, 2016</span>&nbsp;·&nbsp;<span>Duy Do</span></div></header><div class=post-content><p>This post is part of a series covering the architecture of Elasticsearch based on my experience while working with it. In this post, we’ll be discussing how the cluster works, try to find answers for following questions:</p><ul><li>How a node in cluster talks to others?</li><li>What happens when a node joins or leaves the cluster?</li><li>What happens when a node stops or has encountered a problem?</li></ul><h2 id=a-cluster-of-nodes>A Cluster of Nodes<a hidden class=anchor aria-hidden=true href=#a-cluster-of-nodes>#</a></h2><p>When we start an instance of Elasticsearch, we are starting a <em>node</em> and we have a <em>cluster</em> with single node. We start another instance of Elasticsearch has same <code>cluster.name</code> with the first instance and we have a cluster with two nodes. We can start more instances of Elasticsearch to form a cluster with number of nodes we want.</p><p>Every node in the cluster knows about the other nodes within the cluster, they talk to others directly using the native Elasticsearch language over <a href=https://en.wikipedia.org/wiki/Transmission_Control_Protocol>TCP</a>. This is known as a <a href=http://en.wikipedia.org/wiki/Network_topology#Mesh>full connected mesh topology</a>:</p><p><img alt="full connected mesh topology" loading=lazy src=https://upload.wikimedia.org/wikipedia/commons/3/3c/NetworkTopology-FullyConnected.png></p><p><em>Figure 1. Full connected mesh topology (source <a href=https://upload.wikimedia.org/wikipedia/commons/3/3c/NetworkTopology-FullyConnected.png>https://upload.wikimedia.org/wikipedia/commons/3/3c/NetworkTopology-FullyConnected.png</a>)</em></p><p>Besides that, the nodes are able to talk to external world using <a href=http://www.json.org>JSON</a> &ldquo;language&rdquo; over <a href=https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol>HTTP</a>.</p><p>So, we can say:</p><blockquote><p>Elasticsearch is <a href=https://en.wikipedia.org/wiki/Peer-to-peer>peer-to-peer</a> based system, nodes communicate with others directly.</p></blockquote><p>Each node in the cluster plays one or more roles; it can be a <em>master</em> node, <em>data</em> node, <em>client</em> node, or <em>tribe</em> node. Ech role has it own purpose.</p><p><strong>The master node</strong> is responsible for creating, deleting indices, adding the nodes or remove the nodes from the cluster. Each time a cluster state is changed, the master node broadcasts the changes to other nodes in the cluster. There is only one master node in the cluster at a time.</p><p><strong>The data node</strong> is responsible for holding the data in the shards and performing data related operations such as create, read, update, delete, search, and aggregations. We can have many data nodes in the cluster. If one of the data nodes stops, the cluster still operates and re-organizes the data on other nodes.</p><p><strong>The client node</strong> is responsible for routing the cluster-related requests to the master node and the data-related requests to the data nodes, it acts as a &ldquo;smart <a href=https://en.wikipedia.org/wiki/Router_(computing)>router</a>&rdquo;. The client node does not hold any data, it also cannot become the master node.</p><p><img alt=es_client_to_data_nodes loading=lazy src=/images/es_client_to_data_nodes.png>
<em>Figure 2. The client node routes the data-related request to every data nodes in the cluster.</em>
<img alt=es_client_to_data_nodes loading=lazy src=/images/es_client_to_master_node.png>
<em>Figure 3. The client node routes the cluster-related request to the master node in the cluster.</em></p><p><strong>The tribe node</strong> is special type of client node that is able to talk to multiple clusters to perform search and other operations.</p><p><strong>The ingest node</strong> is responsible for pre-processing documents before the actual indexing takes into account.</p><p>Now we know role of each node, next we look at what happens behind the sence when a node joins or leaves the cluster.</p><h2 id=add-a-node-to-the-cluster>Add a Node to the Cluster<a hidden class=anchor aria-hidden=true href=#add-a-node-to-the-cluster>#</a></h2><p>When we start a node, the node is starting to ping all the nodes in the cluster for finding the master node. Once the master is found, it will ask the master to join by sending a join request; the master accepts it as a new node of the cluster and then notify all the nodes in the cluster about presense of the new node, and finally the new node connects to all other nodes.</p><p>If the joined node is a data node, the master will reallocate the data evenly across the nodes.</p><h2 id=remove-a-node-from-the-cluster>Remove a Node from the Cluster<a hidden class=anchor aria-hidden=true href=#remove-a-node-from-the-cluster>#</a></h2><p>If we stop a node or a node in the cluster is unresponsive in specific amout of time, the master node will remove it from the cluster and reallocate the data if the removed node is a data node.</p><p>You might be curious about how the master node knows if other nodes in the cluster are still alive. The master has a fault detection machanism, it pings all the other nodes in the cluster and verify that they are alive or not.</p><p>And about the master, what happens if it stops or has encountered a problem? Same the master node, each node in the cluster also have a fault detection machanism, it pings to master to verify if its still alive. If the master is not alive, other master-eligible nodes will be elected new master to replace the down one within seconds.</p><p>In the next post in this series, we will look at how Elasticsearc index data in a distributed maner.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://duydo.me/tags/elasticsearch/>Elasticsearch</a></li><li><a href=https://duydo.me/tags/engineering/>Engineering</a></li><li><a href=https://duydo.me/tags/searchengine/>Searchengine</a></li><li><a href=https://duydo.me/tags/informationretrieval/>Informationretrieval</a></li></ul><nav class=paginav><a class=prev href=https://duydo.me/how-to-build-elasticsearch-vietnamese-analysis-plugin/><span class=title>« Prev</span><br><span>How to build Elasticsearch Vietnamese Analysis Plugin</span>
</a><a class=next href=https://duydo.me/effective-persistence-of-enums-in-java-a-deep-dive-into-safe-and-scalable-design/><span class=title>Next »</span><br><span>Effective Persistence of Enums in Java: A Deep Dive into Safe and Scalable Design</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://duydo.me/>Duy Do</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>