<!doctype html><html lang=en dir=auto data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Understanding Elasticsearch searching data flow | Duy Do</title><meta name=keywords content="elasticsearch,engineering"><meta name=description content="Search is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including
full-text searches, geo searches, range searches, scripted searches, and aggregations.
How does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching
operations."><meta name=author content="Duy Do"><link rel=canonical href=https://duydo.me/post/elasticsearch-searching-data-flow/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://duydo.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://duydo.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://duydo.me/favicon-32x32.png><link rel=apple-touch-icon href=https://duydo.me/apple-touch-icon.png><link rel=mask-icon href=https://duydo.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://duydo.me/post/elasticsearch-searching-data-flow/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"&&(document.querySelector("html").dataset.theme="dark")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MWQHCX1NZ9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MWQHCX1NZ9")</script><meta property="og:url" content="https://duydo.me/post/elasticsearch-searching-data-flow/"><meta property="og:site_name" content="Duy Do"><meta property="og:title" content="Understanding Elasticsearch searching data flow"><meta property="og:description" content="Search is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including full-text searches, geo searches, range searches, scripted searches, and aggregations.
How does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching operations."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-11T22:32:29+07:00"><meta property="article:modified_time" content="2023-01-11T22:32:29+07:00"><meta property="article:tag" content="Elasticsearch"><meta property="article:tag" content="Engineering"><meta property="og:image" content="https://duydo.me/images/posts/es-searching-data-flow.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://duydo.me/images/posts/es-searching-data-flow.png"><meta name=twitter:title content="Understanding Elasticsearch searching data flow"><meta name=twitter:description content="Search is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including
full-text searches, geo searches, range searches, scripted searches, and aggregations.
How does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching
operations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://duydo.me/post/"},{"@type":"ListItem","position":2,"name":"Understanding Elasticsearch searching data flow","item":"https://duydo.me/post/elasticsearch-searching-data-flow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Understanding Elasticsearch searching data flow","name":"Understanding Elasticsearch searching data flow","description":"Search is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including full-text searches, geo searches, range searches, scripted searches, and aggregations.\nHow does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching operations.\n","keywords":["elasticsearch","engineering"],"articleBody":"Search is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including full-text searches, geo searches, range searches, scripted searches, and aggregations.\nHow does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching operations.\nElasticsearch executes searches in phases known informally as scatter, search, gather, and merge.\nPhase 1: Scatter The client makes a search request to the cluster, a coordinator node in the cluster takes the request to process. Based on the index’s information, the coordinator node routes the search request to all data nodes which contain index’s data.\nPhase 2: Search Each data node, which received the search request in “Phase 1”, parses the request to check if any query clauses in search query needs to be applied text analysis process. If yes, the text analysis processing gets started. Finally, the data node executes the search request on every segment of the index’s shards.\nPhase 3: Gather \u0026 Merge The coordinator node in “Phase 1” gathers the search results from all data nodes that it routed the search request to. After the gathering processing is done, the merging processing gets started. It merges, ranks and sorts the search results then returning them back to the client.\n","wordCount":"207","inLanguage":"en","image":"https://duydo.me/images/posts/es-searching-data-flow.png","datePublished":"2023-01-11T22:32:29+07:00","dateModified":"2023-01-11T22:32:29+07:00","author":{"@type":"Person","name":"Duy Do"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://duydo.me/post/elasticsearch-searching-data-flow/"},"publisher":{"@type":"Organization","name":"Duy Do","logo":{"@type":"ImageObject","url":"https://duydo.me/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://duydo.me/ accesskey=h title="Duy Do (Alt + H)">Duy Do</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://duydo.me/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Understanding Elasticsearch searching data flow</h1><div class=post-meta><span title='2023-01-11 22:32:29 +0700 +07'>Jan 11, 2023</span>&nbsp;·&nbsp;<span>Duy Do</span></div></header><figure class=entry-cover><img loading=eager src=https://duydo.me/images/posts/es-searching-data-flow.png alt="Elasticsearch Searching Data Flow"><figcaption>Elasticsearch Searching Data Flow</figcaption></figure><div class=post-content><p><strong>Search</strong> is a generic term for information retrieval. Elasticsearch provides various retrieval capabilities, including
full-text searches, geo searches, range searches, scripted searches, and aggregations.</p><p>How does Elasticsearch execute a search query behind the scenes? The following diagram shows data flow for searching
operations.</p><p>Elasticsearch executes searches in phases known informally as <strong>scatter</strong>, <strong>search</strong>, <strong>gather</strong>, and <strong>merge</strong>.</p><h3 id=phase-1-scatter>Phase 1: Scatter<a hidden class=anchor aria-hidden=true href=#phase-1-scatter>#</a></h3><p>The client makes a search request to the cluster, a coordinator node in the cluster takes the request to
process. Based on the index&rsquo;s information, the coordinator node routes the search request to all data nodes
which contain index&rsquo;s data.</p><h3 id=phase-2-search>Phase 2: Search<a hidden class=anchor aria-hidden=true href=#phase-2-search>#</a></h3><p>Each data node, which received the search request in &ldquo;Phase 1&rdquo;, parses the request to check if any query clauses in
search query needs to be applied <em>text analysis process</em>. If <code>yes</code>, the text analysis processing gets started. Finally, the data node
executes the search request on every segment of the index&rsquo;s shards.</p><h3 id=phase-3-gather--merge>Phase 3: Gather & Merge<a hidden class=anchor aria-hidden=true href=#phase-3-gather--merge>#</a></h3><p>The coordinator node in &ldquo;Phase 1&rdquo; gathers the search results from all data nodes that it routed the search request to.
After the gathering processing is done, the merging processing gets started. It merges, ranks and sorts the search
results then returning them back to the client.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://duydo.me/tags/elasticsearch/>Elasticsearch</a></li><li><a href=https://duydo.me/tags/engineering/>Engineering</a></li></ul><nav class=paginav><a class=prev href=https://duydo.me/post/honored-to-be-an-elastic-contributor/><span class=title>« Prev</span><br><span>Honored to Be an Elastic Contributor</span>
</a><a class=next href=https://duydo.me/post/elasticsearch-deleting-data-flow/><span class=title>Next »</span><br><span>Understanding Elasticsearch deleting data flow</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://duydo.me/>Duy Do</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>