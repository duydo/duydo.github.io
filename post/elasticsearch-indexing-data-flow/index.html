<!doctype html><html lang=en dir=auto data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Understanding Elasticsearch indexing data flow | Duy Do</title><meta name=keywords content="elasticsearch,engineering"><meta name=description content="When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index
data structure that supports full-text searches efficiently and very fast."><meta name=author content="Duy Do"><link rel=canonical href=https://duydo.me/post/elasticsearch-indexing-data-flow/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://duydo.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://duydo.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://duydo.me/favicon-32x32.png><link rel=apple-touch-icon href=https://duydo.me/apple-touch-icon.png><link rel=mask-icon href=https://duydo.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://duydo.me/post/elasticsearch-indexing-data-flow/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"&&(document.querySelector("html").dataset.theme="dark")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MWQHCX1NZ9"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MWQHCX1NZ9")</script><meta property="og:url" content="https://duydo.me/post/elasticsearch-indexing-data-flow/"><meta property="og:site_name" content="Duy Do"><meta property="og:title" content="Understanding Elasticsearch indexing data flow"><meta property="og:description" content="When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index data structure that supports full-text searches efficiently and very fast."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-09T07:52:35+07:00"><meta property="article:modified_time" content="2023-01-10T07:52:35+07:00"><meta property="article:tag" content="Elasticsearch"><meta property="article:tag" content="Engineering"><meta property="og:image" content="https://duydo.me/images/posts/es_index_operations.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://duydo.me/images/posts/es_index_operations.png"><meta name=twitter:title content="Understanding Elasticsearch indexing data flow"><meta name=twitter:description content="When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index
data structure that supports full-text searches efficiently and very fast."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://duydo.me/post/"},{"@type":"ListItem","position":2,"name":"Understanding Elasticsearch indexing data flow","item":"https://duydo.me/post/elasticsearch-indexing-data-flow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Understanding Elasticsearch indexing data flow","name":"Understanding Elasticsearch indexing data flow","description":"When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index data structure that supports full-text searches efficiently and very fast.\n","keywords":["elasticsearch","engineering"],"articleBody":"When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index data structure that supports full-text searches efficiently and very fast.\nThe above diagram shows the data flow when a document is indexed into a Elasticsearch cluster. It includes following basic steps:\nStep 1: The client makes a request to put a document into the cluster, a coordinator node in the cluster takes the request to process.\nStep 2: The coordinator node uses the pipeline parameter in the indexing request to check if the document needs to be enriched or transformed before routing to a data node for further processing.\nIf answer is No, the document is routed to a data node in the cluster. If the answer is Yes, the document is routed to an ingest node in the cluster to enrich the document. When the enriching process is done, the ingest node continues routing the enriched document to the data node.\nDecision of which data node in the cluster will take the document to process further is based on index’s shard information and the hashing modulo formular:\nshard = hash(routing) % number_of_shards\nStep 3: The data node parses the document to a JSON object then checking if there is any text values in the object. If the text values are found, a text analysis process will be involved. It analyzes, breaks the text into more useful structural components. It also applies some processing to make the document more relevant to fulltext search. Finally, the document is added to a memory buffer and appended to the transaction log.\nWhen the buffer fills up, the documents are written to a segment and then the buffer is clear. In the meantime, the transaction log still keeps the documents until it gets big enough, a full commit is performed. The documents is flushed to disk permanently, the old transaction log is deleted and the new one is created.\nIf the replication is enabled, the replication data process are triggered. This data node sends a replication request to a data node which contains replicas shards of the index. The whole indexing process here will be done on that node to create a copy of those documents.\n","wordCount":"373","inLanguage":"en","image":"https://duydo.me/images/posts/es_index_operations.png","datePublished":"2023-01-09T07:52:35+07:00","dateModified":"2023-01-10T07:52:35+07:00","author":{"@type":"Person","name":"Duy Do"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://duydo.me/post/elasticsearch-indexing-data-flow/"},"publisher":{"@type":"Organization","name":"Duy Do","logo":{"@type":"ImageObject","url":"https://duydo.me/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://duydo.me/ accesskey=h title="Duy Do (Alt + H)">Duy Do</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://duydo.me/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Understanding Elasticsearch indexing data flow</h1><div class=post-meta><span title='2023-01-09 07:52:35 +0700 +07'>Jan 9, 2023</span>&nbsp;·&nbsp;<span>Duy Do</span></div></header><figure class=entry-cover><img loading=eager src=https://duydo.me/images/posts/es_index_operations.png alt="Elasticsearch Indexing Data Flow"><figcaption>Elasticsearch Indexing Data Flow</figcaption></figure><div class=post-content><p>When a document is stored in Elasticsearch, it is indexed and fully searchable within 1 second. Elasticsearch uses an inverted index
data structure that supports full-text searches efficiently and very fast.</p><p>The above diagram shows the data flow when a document is indexed into a Elasticsearch cluster. It includes following basic steps:</p><p><strong>Step 1</strong>: The client makes a request to put a document into the cluster, a coordinator node in the cluster takes the request to
process.</p><p><strong>Step 2</strong>: The coordinator node uses the <code>pipeline</code> parameter in the indexing request to check if the document needs to
be enriched or transformed before routing to a data node for further processing.</p><p>If answer is <code>No</code>, the document is routed to a data node in the cluster. If the answer is <code>Yes</code>, the document is routed to an ingest node in the
cluster to enrich the document. When the enriching process is done, the ingest node continues routing the enriched document to the data node.</p><p>Decision of which data node in the cluster will take the document to process further is based on index&rsquo;s shard information and the hashing modulo formular:</p><p><code>shard = hash(routing) % number_of_shards</code></p><p><strong>Step 3</strong>: The data node parses the document to a JSON object then checking if there is any <code>text</code> values in the object.
If the <code>text</code> values are found, a text analysis process will be involved. It analyzes, breaks the text into more
useful structural components. It also applies some processing to make the document more relevant to fulltext search.
Finally, the document is added to a memory buffer and appended to the transaction log.</p><p>When the buffer fills up, the documents are written to a segment and then the buffer is clear. In the meantime, the
transaction log still keeps the documents until it gets big enough, a full commit is performed. The documents is flushed to disk permanently,
the old transaction log is deleted and the new one is created.</p><p>If the replication is enabled, the replication data process are triggered. This data node sends a replication request
to a data node which contains replicas shards of the index. The whole indexing process here will be done on that node to
create a copy of those documents.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://duydo.me/tags/elasticsearch/>Elasticsearch</a></li><li><a href=https://duydo.me/tags/engineering/>Engineering</a></li></ul><nav class=paginav><a class=prev href=https://duydo.me/post/elasticsearch-deleting-data-flow/><span class=title>« Prev</span><br><span>Understanding Elasticsearch deleting data flow</span>
</a><a class=next href=https://duydo.me/post/an_algorithm_for_finding_largest_right_truncatable_prime/><span class=title>Next »</span><br><span>An algorithm for finding right-truncatable prime numbers</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://duydo.me/>Duy Do</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>