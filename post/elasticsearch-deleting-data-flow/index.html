<!doctype html><html lang=en dir=auto data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Understanding Elasticsearch deleting data flow | Duy Do</title><meta name=keywords content="elasticsearch,engineering"><meta name=description content="How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.





    
            Elasticsearch Deleting Data Flow
        
"><meta name=author content="Duy Do"><link rel=canonical href=https://duydo.me/post/elasticsearch-deleting-data-flow/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://duydo.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://duydo.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://duydo.me/favicon-32x32.png><link rel=apple-touch-icon href=https://duydo.me/apple-touch-icon.png><link rel=mask-icon href=https://duydo.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://duydo.me/post/elasticsearch-deleting-data-flow/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"&&(document.querySelector("html").dataset.theme="dark")</script><meta property="og:url" content="https://duydo.me/post/elasticsearch-deleting-data-flow/"><meta property="og:site_name" content="Duy Do"><meta property="og:title" content="Understanding Elasticsearch deleting data flow"><meta property="og:description" content="How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.
Elasticsearch Deleting Data Flow"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-01-10T12:51:30+07:00"><meta property="article:modified_time" content="2023-01-13T12:51:30+07:00"><meta property="article:tag" content="Elasticsearch"><meta property="article:tag" content="Engineering"><meta property="og:image" content="https://duydo.me/images/posts/es-deleting-data-flow.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://duydo.me/images/posts/es-deleting-data-flow.png"><meta name=twitter:title content="Understanding Elasticsearch deleting data flow"><meta name=twitter:description content="How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.





    
            Elasticsearch Deleting Data Flow
        
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://duydo.me/post/"},{"@type":"ListItem","position":2,"name":"Understanding Elasticsearch deleting data flow","item":"https://duydo.me/post/elasticsearch-deleting-data-flow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Understanding Elasticsearch deleting data flow","name":"Understanding Elasticsearch deleting data flow","description":"How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.\nElasticsearch Deleting Data Flow\n","keywords":["elasticsearch","engineering"],"articleBody":"How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.\nElasticsearch Deleting Data Flow\nStep 1: The client makes a request to delete a document from the cluster, a coordinator node in the cluster takes the request to process.\nStep 2: Based on shard information and the document ID, the coordinator node routes the delete request to a data node which contains primary shard that stored the document.\nStep 3: The data node doesn’t delete the document immediately, it marks the document as deleted then adding it to the memory buffer and appending it to the transaction log. At this time, the document is unsearchable.\nWhen the buffer fills up, the changes are written to a segment and the buffer is clear. In the meantime, the transaction log still keeps the deleted documents until it gets too big, a full commit is performed. The changes are flushed to disk, the document is deleted permanently.\nIf replication is enabled for the index, the replication data process gets started. This data node sends the delete request to a data node which contains replicas shards of the index. The whole deleting process here will be done on that node to delete the document from the replica shards completely.\n","wordCount":"216","inLanguage":"en","image":"https://duydo.me/images/posts/es-deleting-data-flow.png","datePublished":"2023-01-10T12:51:30+07:00","dateModified":"2023-01-13T12:51:30+07:00","author":{"@type":"Person","name":"Duy Do"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://duydo.me/post/elasticsearch-deleting-data-flow/"},"publisher":{"@type":"Organization","name":"Duy Do","logo":{"@type":"ImageObject","url":"https://duydo.me/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://duydo.me/ accesskey=h title="Duy Do (Alt + H)">Duy Do</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://duydo.me/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Understanding Elasticsearch deleting data flow</h1><div class=post-meta><span title='2023-01-10 12:51:30 +0700 +07'>Jan 10, 2023</span>&nbsp;·&nbsp;<span>Duy Do</span></div></header><figure class=entry-cover><img loading=eager src=https://duydo.me/images/posts/es-deleting-data-flow.png alt="Elasticsearch Indexing Data Flow"><figcaption>Elasticsearch Indexing Data Flow</figcaption></figure><div class=post-content><p>How is a document deleted from Elasticsearch? The following diagram shows data flow behinds the scene of deleting a single document.</p><figure class=align-center><img loading=lazy src=/images/posts/es-deleting-data-flow.png alt="Elasticsearch Deleting Data Flow"><figcaption><p>Elasticsearch Deleting Data Flow</p></figcaption></figure><p><strong>Step 1</strong>: The client makes a request to delete a document from the cluster, a coordinator node in the cluster takes the request to
process.</p><p><strong>Step 2</strong>: Based on shard information and the document ID, the coordinator node routes the delete request to a data node
which contains primary shard that stored the document.</p><p><strong>Step 3</strong>: The data node doesn&rsquo;t delete the document immediately, it marks the document as deleted then adding it to
the memory buffer and appending it to the transaction log. At this time, the document is unsearchable.</p><p>When the buffer fills up, the changes are written to a segment and the buffer is clear. In the meantime, the
transaction log still keeps the deleted documents until it gets too big, a full commit is performed. The changes are flushed to
disk, the document is deleted permanently.</p><p>If replication is enabled for the index, the replication data process gets started. This data node sends the delete request
to a data node which contains replicas shards of the index. The whole deleting process here will be done on that node to
delete the document from the replica shards completely.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://duydo.me/tags/elasticsearch/>Elasticsearch</a></li><li><a href=https://duydo.me/tags/engineering/>Engineering</a></li></ul><nav class=paginav><a class=prev href=https://duydo.me/post/elasticsearch-searching-data-flow/><span class=title>« Prev</span><br><span>Understanding Elasticsearch searching data flow</span>
</a><a class=next href=https://duydo.me/post/elasticsearch-indexing-data-flow/><span class=title>Next »</span><br><span>Understanding Elasticsearch indexing data flow</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://duydo.me/>Duy Do</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>