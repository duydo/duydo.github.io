<!DOCTYPE HTML>

<html lang="en-us">

<head>
	<meta charset="utf-8">
	<title>Effective JPA: Use Enumeration Effectively - Duy Do</title>
	<meta name="author" content="map[name:Duy Do bio:Software Engineer in Vietnam email:]">

	
	
	<meta name="description" content="">
	

	
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
	<link href='/index.xml' rel="alternate" title="Duy Do" type="application/atom+xml">
	
	<link rel="canonical" href="http://duydo.me/post/effective-jpa/">
	<link href="http://duydo.me/favicon.png" rel="shortcut icon">
	<link href="http://duydo.me/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="http://duydo.me/css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<link href="http://duydo.me/css/style.css" media="screen, projection" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-68329720-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><section class="author">
    
<div class="author-avatar">
    <a href="http://duydo.me/">
        <img src='http://www.gravatar.com/avatar/6ac96bcb854145bb47eac6fa80b50d44?s=120'
             alt="Duy Do"
             style="width: 120px;"/>
    </a>

    <h1>
        <a class="author-name" href="http://duydo.me/">
            Duy Do
        </a>

        <p class="bio">
            Software Engineer in Vietnam
        </p>
    </h1>

</div>


<nav id="sub-nav" class="author-social">
    <div class="social">
        
        
        
        
        <a class="twitter" href='http://twitter.com/duydo' title="Twitter">Twitter</a>
        
        
        <a class="github" href='https://github.com/duydo' title="GitHub">GitHub</a>
        
        
        <a class="linkedin" href='http://www.linkedin.com/in/duydo' title="LinkedIn">LinkedIn</a>
        
        
        <a class="rss" href='/index.xml' title="RSS">RSS</a>
        
    </div>
</nav>

</section>
<nav id="main-nav">
    <ul>
    <li><a href="http://duydo.me/">Blog</a></li>
    <li><a href="http://duydo.me/post/">Archives</a></li>
    
</ul>

</nav>
</header>
			</div>
		</div>
		<div class="mid-col">
			
			<div class="mid-col-container">

				<div id="content" class="inner">

					<div itemscope itemtype="http://schema.org/Blog">
						<div class="entry-meta clearfix">
      <div class="meta-left">
        <a class="author-avatar" href="http://duydo.me/about">
            <img src='http://www.gravatar.com/avatar/6ac96bcb854145bb47eac6fa80b50d44?s=32'
                 alt="Duy Do"
                 style="width: 32px;"/>

        </a>
</div>
<div class="meta-right">
    <span class="entry-author-name">
                <a href="http://duydo.me/about">

Duy Do
                    </a>
        </span>

in <span class="entry-tags">


	
	
		<a href="http://duydo.me/tags/java">java</a>,
	

	
	
	    <a href="http://duydo.me/tags/jpa">jpa</a>
	


</span>

<br/>
<span class="entry-date">
        <time datetime='Sunday, January 24, 2010' data-updated="true" itemprop="datePublished">Sunday, January 24, 2010</time>

    </span> - <span class="reading-time">3 min read</span>
</div>
	</div>
					<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="title" itemprop="name">Effective JPA: Use Enumeration Effectively</h1>
	<div class="entry-content" itemprop="articleBody"><p>How to persist an enumeration effectively? This is my experience on this subject.</p>

<p>I use WordPress for example. We all know that every post in Wordpress blog system has a status with possible values: draft, pending-review, published.</p>

<p>There are some ways to model the post entity, we can save status as an integer value in database: draft -&gt; 0, pending-review -&gt; 1, published -&gt; 2</p>

<p>Version 1</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">@Entity</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Post</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #a6e22e">getStatus</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">status</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>Well that’s ok. A client can use:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Post</span> <span style="color: #f8f8f2">post</span> <span style="color: #f92672">=</span> <span style="color: #f92672">...;</span>
<span style="color: #75715e">//Draft post</span>
<span style="color: #f8f8f2">post</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">repository</span><span style="color: #f92672">.</span><span style="color: #a6e22e">store</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">post</span><span style="color: #f92672">);</span>
</pre></div>

<p>But this is not safe, the client can set any integer value for status. For more safety, we can define constants for status values like this:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">PostStatus</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">DRAFT</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">PENDING_REVIEW</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">PUBLISHED</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">2</span><span style="color: #f92672">;</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>The client can use:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Post</span> <span style="color: #f8f8f2">post</span> <span style="color: #f92672">=</span> <span style="color: #f92672">...;</span>
<span style="color: #75715e">//Draft post</span>
<span style="color: #f8f8f2">post</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PostStatus</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DRAFT</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">repository</span><span style="color: #f92672">.</span><span style="color: #a6e22e">store</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">post</span><span style="color: #f92672">);</span>
</pre></div>

<p>But it is still not safe, because the client maybe do not use PostStatus class. Well, we can force the client use PostStatus by declaring PostStatus as an Enum and make it as as dependency of Post class:</p>

<p>Version 2</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">PostStatus</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">DRAFT</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">PENDING_REVIEW</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">PUBLISHED</span><span style="color: #f92672">;</span>
<span style="color: #f92672">}</span>
<span style="color: #a6e22e">@Entity</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Post</span> <span style="color: #f92672">{</span>
	<span style="color: #a6e22e">@Enumerated</span>
	<span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">PostStatus</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">PostStatus</span> <span style="color: #a6e22e">getStatus</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PostStatus</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">status</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>And now client can use it:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">Post</span> <span style="color: #f8f8f2">post</span> <span style="color: #f92672">=</span> <span style="color: #f92672">...;</span>
<span style="color: #75715e">//Draft post</span>
<span style="color: #f8f8f2">post</span><span style="color: #f92672">.</span><span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PostStatus</span><span style="color: #f92672">.</span><span style="color: #a6e22e">DRAFT</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">repository</span><span style="color: #f92672">.</span><span style="color: #a6e22e">store</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">post</span><span style="color: #f92672">);</span>
</pre></div>

<p>Well, it is better. But wait&hellip;we know that JPA persists all enum constants in order we declare them in PostStatus with value started from 0. This is limitation, we can not change order of constants, we only can append a new constant. How does we solve this limitation?</p>

<p>Version 3
Enum type in Java 5 is wonderful, we can add constructor and do some business logic in it. Apply it we can re-write PostStatus like this:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">PostStatus</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">DRAFT</span><span style="color: #f92672">(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">),</span>
	<span style="color: #f8f8f2">PENDING_REVIEW</span><span style="color: #f92672">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672">),</span>
	<span style="color: #f8f8f2">PUBLISHED</span><span style="color: #f92672">(</span><span style="color: #ae81ff">2</span><span style="color: #f92672">);</span>
	<span style="color: #66d9ef">private</span> <span style="color: #66d9ef">final</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">private</span> <span style="color: #a6e22e">PostStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">value</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #a6e22e">getValue</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>And Post class is re-wrote like this:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #a6e22e">@Entity</span>
<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Post</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #f8f8f2">Integer</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #f8f8f2">PostStatus</span> <span style="color: #a6e22e">getStatus</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #75715e">//TODO we need a helper to convert status value to PostStatus enum</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f92672">...;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">setStatus</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">PostStatus</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">status</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">status</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getValue</span><span style="color: #f92672">();</span>
	<span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>Great!!! Now the client can use code safety, we can also add many constants into PostStatus without worry about the order of them.</p>

<p>It reminds me of the sentence the guy talked in Java4Ever trailer: “Look how beautiful, robust, secure, portable and scalable it is” ;-)</p>

<p><em>I copy this post from my old blog.</em></p>
</div></article>
					
						<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size=''></a>
	
	
	</div>
	
  	<script type="text/javascript" src='http://s7.addthis.com/js/250/addthis_widget.js#pubid='></script>
  	
</div>

					
					
					<section id="comment">
					    <h1 class="title">Comments</h1>
					    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
					</section>
					
					

<script type="text/javascript">
    
    var disqus_shortname = 'duydo';

    
    

    
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
    
</script>


				    </div>
				</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016 Duy Do. Powered by <a target="_blank" href="http://gohugo.io">Hugo</a>.

<script src="http://duydo.me/js/slash.js"></script>
<script src="http://duydo.me/js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script></footer>
		</div>
	</div>
	
</body>
</html>
