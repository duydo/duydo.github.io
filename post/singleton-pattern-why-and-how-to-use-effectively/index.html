<!DOCTYPE HTML>

<html lang="en-us">

<head>
	<meta charset="utf-8">
	<title>Singleton Pattern: Why and how to use it effectively - Duy Do</title>
	<meta name="author" content="map[bio:Software Engineer in Vietnam email: name:Duy Do]">

	
	
	<meta name="description" content="">
	

	
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    
	<link href='/index.xml' rel="alternate" title="Duy Do" type="application/atom+xml">
	
	<link rel="canonical" href="http://duydo.me/post/singleton-pattern-why-and-how-to-use-effectively/">
	<link href="http://duydo.me/favicon.png" rel="shortcut icon">
	<link href="http://duydo.me/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="http://duydo.me/css/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
		<link href="http://duydo.me/css/style.css" media="screen, projection" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-68329720-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><section class="author">
    
<div class="author-avatar">
    <a href="http://duydo.me/page/about">
        <img src='http://www.gravatar.com/avatar/6ac96bcb854145bb47eac6fa80b50d44?s=120'
             alt="Duy Do"
             style="width: 120px;"/>
    </a>

    <h1>
        <a class="author-name" href="http://duydo.me/page/about">
            Duy Do
        </a>

        <p class="bio">
            Software Engineer in Vietnam
        </p>
    </h1>

</div>


<nav id="sub-nav" class="author-social">
    <div class="social">
        
        
        
        
        <a class="twitter" href='http://twitter.com/duydo' title="Twitter">Twitter</a>
        
        
        <a class="github" href='https://github.com/duydo' title="GitHub">GitHub</a>
        
        
        <a class="linkedin" href='http://www.linkedin.com/in/duydo' title="LinkedIn">LinkedIn</a>
        
        
        <a class="rss" href='/index.xml' title="RSS">RSS</a>
        
    </div>
</nav>

</section>
<nav id="main-nav">
    <ul>
    <li><a href="http://duydo.me/">Blog</a></li>
    <li><a href="http://duydo.me/post/">Archives</a></li>
    <li><a href="http://duydo.me/page/about/">About</a></li>
</ul>

</nav>
</header>
			</div>
		</div>
		<div class="mid-col">
			
			<div class="mid-col-container">

				<div id="content" class="inner">

					<div itemscope itemtype="http://schema.org/Blog">
						<div class="entry-meta clearfix">
      <div class="meta-left">
        <a class="author-avatar" href="http://duydo.me/page/about">
            <img src='http://www.gravatar.com/avatar/6ac96bcb854145bb47eac6fa80b50d44?s=32'
                 alt="Duy Do"
                 style="width: 32px;"/>

        </a>
</div>
<div class="meta-right">
    <span class="entry-author-name">
                <a href="http://duydo.me/page/about">

Duy Do
                    </a>
        </span>

in <span class="entry-tags">


	
	
	    <a href="http://duydo.me/tags/design-patterns">design-patterns</a>
	


</span>

<br/>
<span class="entry-date">
        <time datetime='Sunday, September 28, 2008' data-updated="true" itemprop="datePublished">Sunday, September 28, 2008</time>

    </span> - <span class="reading-time">4 min read</span>
</div>
	</div>
					<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <h1 class="title" itemprop="name">Singleton Pattern: Why and how to use it effectively</h1>
	<div class="entry-content" itemprop="articleBody"><p>First, consider definition for Singleton Patten:</p>

<blockquote>
<p><em>The Singleton Pattern ensures a class has only one instance, and provides a global point of access to it.</em></p>
</blockquote>

<p>From this definition we can see the purpose of using this pattern:</p>

<p>It ensures we have at most one instance of a class in our application.
It also provides global access point to that instance. We can access to that instance  everywhere in our application.
And now, wen implement it, I use Java:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Singleton</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * This private constructor prevents create an instance of Singleton class directly.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #f8f8f2">pritvate</span> <span style="color: #a6e22e">Singleton</span><span style="color: #f92672">(){}</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * Use this method to create an instance of Singleton class.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #a6e22e">getInstance</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">instance</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">){</span>
			<span style="color: #f8f8f2">instance</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Singleton</span><span style="color: #f92672">();</span>
		<span style="color: #f92672">}</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #75715e">// other useful methods</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">doSomething</span><span style="color: #f92672">()</span> <span style="color: #f92672">{}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>It is simple, isn’t it? This is an traditional implementation for this pattern.</p>

<p>When we implement the Singleton Pattern, we <strong>MUST NOT</strong> provide <strong>PUBLIC CONSTRUCTOR</strong> to our singleton class. If we provide public constructor, we let our client has another chance to create an instance of your Singleton class directly, this does not ensure you have only one instance in our application.</p>

<p>We have problem with multi-threading environment?</p>

<p>The traditional implementation only works fine with single thread environment, but with multi-threading environment we have a problem.</p>

<p>Imaging we have two threads want to create an instance of Singleton at same time. What happens?</p>

<table>
<thead>
<tr>
<th>Thread #1</th>
<th align="center">Thread #2</th>
</tr>
</thead>

<tbody>
<tr>
<td>if(instance == null) {</td>
<td align="center"></td>
</tr>

<tr>
<td>instance = new Singleton();</td>
<td align="center"></td>
</tr>

<tr>
<td></td>
<td align="center">instance = new Singleton();</td>
</tr>

<tr>
<td>}</td>
<td align="center"></td>
</tr>

<tr>
<td>return instance;</td>
<td align="center"></td>
</tr>
</tbody>
</table>

<p>Problem? Yes, we have two instances of Singleton class. How do we fix this problem?</p>

<p><strong>1. Synchronize method getInstance()</strong></p>

<p>Synchronize method getInstance() with synchronized keyword. This ensures only one thread can execute getInstance() method at one time. Another thread wants to execute this method must wait another thread finish execute the method.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Singleton</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * This private constructor prevents create an instance of Singleton class directly.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #f8f8f2">pritvate</span> <span style="color: #a6e22e">Singleton</span><span style="color: #f92672">(){}</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * Use this method to create an instance of Singleton class.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #66d9ef">synchronized</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #a6e22e">getInstance</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>

		<span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">instance</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">){</span>
			<span style="color: #f8f8f2">instance</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Singleton</span><span style="color: #f92672">();</span>
		<span style="color: #f92672">}</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #75715e">// other useful methods</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">doSomething</span><span style="color: #f92672">()</span> <span style="color: #f92672">{}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>But, this can cause performance problem because of using synchronized fairly expensive (by factor of 100)
So, use this fix if performance is not critical in your application. Otherwise, you can consider use “double-checked locking” technique:</p>

<p><strong>2. Use “double-checked locking” technique</strong></p>

<p>With &ldquo;double-checking locked&rdquo; technique, we only synchronize the first time instance of Singleton class created. This can reduce overhead.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Singleton</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #66d9ef">volatile</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * This private constructor prevents create an instance of Singleton class directly.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #f8f8f2">pritvate</span> <span style="color: #a6e22e">Singleton</span><span style="color: #f92672">(){}</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * Use this method to create an instance of Singleton class.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #a6e22e">getInstance</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #75715e">/* If instance  is null, create it*/</span>
		<span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">instance</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">){</span>
			<span style="color: #66d9ef">synchronized</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Singleton</span><span style="color: #f92672">.</span><span style="color: #a6e22e">class</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
				<span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">instance</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">){</span>
					<span style="color: #f8f8f2">instance</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Singleton</span><span style="color: #f92672">();</span>
				<span style="color: #f92672">}</span>
			<span style="color: #f92672">}</span>
		<span style="color: #f92672">}</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #75715e">// other useful methods here</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">doSomething</span><span style="color: #f92672">()</span> <span style="color: #f92672">{}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>But this technique does not work with JVM 1.4 and earlier because of volatile keyword not implemented. You can move to following way:</p>

<p><strong>3. Eagerly to create instance of Singleton class</strong></p>

<p>If in our application always use instance of Singleton class, we can eagerly create instance of Singleton class rather than a lazy created one, like this:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Singleton</span> <span style="color: #f92672">{</span>
	<span style="color: #66d9ef">private</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #f8f8f2">instance</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Singleton</span><span style="color: #f92672">();</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * This private constructor prevents create an instance of Singleton class directly.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #66d9ef">private</span> <span style="color: #a6e22e">Singleton</span><span style="color: #f92672">(){}</span>
	<span style="color: #75715e">/**</span>
<span style="color: #75715e">	 * Use this method to create an instance of Singleton class.</span>
<span style="color: #75715e">	 */</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">static</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #a6e22e">getInstance</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">instance</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #75715e">// other useful methods</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">doSomething</span><span style="color: #f92672">()</span> <span style="color: #f92672">{}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>This solution works fine in JVM version greater than 1.2. In pre-Java 1.2 JVM has a bug in garbage collector, it allows Singleton to be prematurely collected.</p>

<p><strong>5. Using ENUM</strong></p>

<p>This way was provided by Joshua Bloch in his 2nd Effective Java book.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">public</span> <span style="color: #66d9ef">enum</span> <span style="color: #f8f8f2">Singleton</span> <span style="color: #f92672">{</span>
	<span style="color: #f8f8f2">INSTANCE</span><span style="color: #f92672">;</span>
	<span style="color: #66d9ef">public</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">foo</span><span style="color: #f92672">()</span> <span style="color: #f92672">{</span>
		<span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;FOO&quot;</span><span style="color: #f92672">);</span>
	<span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
</pre></div>

<p>This approach is functionally equivalent to the public field approach, except that it is more concise, provides the serialization machinery for free, and provides an ironclad guarantee against multiple instantiation, even in the face of sophisticated serialization or reflection attacks. While this approach has yet to be widely adopted, a single-element enum type is the best way to implement a singleton.</p>
</div></article>
					
						<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size=''></a>
	
	
	</div>
	
  	<script type="text/javascript" src='http://s7.addthis.com/js/250/addthis_widget.js#pubid='></script>
  	
</div>

					
					
					<section id="comment">
					    <h1 class="title">Comments</h1>
					    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
					</section>
					
					

<script type="text/javascript">
    
    var disqus_shortname = 'duydo';

    
    

    
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
    
</script>


				    </div>
				</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016 Duy Do. Powered by <a target="_blank" href="http://gohugo.io">Hugo</a>.

<script src="http://duydo.me/js/slash.js"></script>
<script src="http://duydo.me/js/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script></footer>
		</div>
	</div>
	
</body>
</html>
